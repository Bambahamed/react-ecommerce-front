import{R as u,N as Ce,u as ge,b as Se,r as P,j as i,P as xe,L as Ee}from"./index-zqpnlBSv.js";import{P as l}from"./index-B0vsPx-2.js";import{f as be,e as je}from"./user-CJaZEO-O.js";import{C as Pe}from"./index-C-L1u7SG.js";import{C as ke}from"./CheckOutlined-Dsv2YYll.js";import{D as we}from"./DollarOutlined-BGCmZ9Zz.js";import"./isVisible-B1buT0cz.js";import"./index-DRABmW48.js";import"./index-AZ08od_9.js";var se="https://js.stripe.com/v3",Oe=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Z="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Ae=function(){for(var e=document.querySelectorAll('script[src^="'.concat(se,'"]')),t=0;t<e.length;t++){var n=e[t];if(Oe.test(n.src))return n}return null},Q=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(se).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(n),n},Ne=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"3.4.1",startTime:t})},T=null,_=null,U=null,Re=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},Te=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Le=function(e){return T!==null?T:(T=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(Z),window.Stripe){t(window.Stripe);return}try{var o=Ae();if(o&&e)console.warn(Z);else if(!o)o=Q(e);else if(o&&U!==null&&_!==null){var a;o.removeEventListener("load",U),o.removeEventListener("error",_),(a=o.parentNode)===null||a===void 0||a.removeChild(o),o=Q(e)}U=Te(t,n),_=Re(n),o.addEventListener("load",U),o.addEventListener("error",_)}catch(c){n(c);return}}),T.catch(function(t){return T=null,Promise.reject(t)}))},De=function(e,t,n){if(e===null)return null;var o=e.apply(void 0,t);return Ne(o,n),o},L,ie=!1,ue=function(){return L||(L=Le(null).catch(function(e){return L=null,Promise.reject(e)}),L)};Promise.resolve().then(function(){return ue()}).catch(function(r){ie||console.warn(r)});var Ie=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];ie=!0;var o=Date.now();return ue().then(function(a){return De(a,t,o)})};function ee(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,n)}return t}function te(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ee(Object(t),!0).forEach(function(n){ce(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ee(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function W(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?W=function(e){return typeof e}:W=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(r)}function ce(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function le(r,e){return _e(r)||Ue(r,e)||We(r,e)||Fe()}function _e(r){if(Array.isArray(r))return r}function Ue(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],o=!0,a=!1,c,m;try{for(t=t.call(r);!(o=(c=t.next()).done)&&(n.push(c.value),!(e&&n.length===e));o=!0);}catch(s){a=!0,m=s}finally{try{!o&&t.return!=null&&t.return()}finally{if(a)throw m}}return n}}function We(r,e){if(r){if(typeof r=="string")return re(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return re(r,e)}}function re(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function Fe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C=function(e,t,n){var o=!!n,a=u.useRef(n);u.useEffect(function(){a.current=n},[n]),u.useEffect(function(){if(!o||!e)return function(){};var c=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,c),function(){e.off(t,c)}},[o,t,e,a])},G=function(e){var t=u.useRef(e);return u.useEffect(function(){t.current=e},[e]),t.current},R=function(e){return e!==null&&W(e)==="object"},Be=function(e){return R(e)&&typeof e.then=="function"},$e=function(e){return R(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ne="[object Object]",Me=function r(e,t){if(!R(e)||!R(t))return e===t;var n=Array.isArray(e),o=Array.isArray(t);if(n!==o)return!1;var a=Object.prototype.toString.call(e)===ne,c=Object.prototype.toString.call(t)===ne;if(a!==c)return!1;if(!a&&!n)return e===t;var m=Object.keys(e),s=Object.keys(t);if(m.length!==s.length)return!1;for(var g={},y=0;y<m.length;y+=1)g[m[y]]=!0;for(var S=0;S<s.length;S+=1)g[s[S]]=!0;var d=Object.keys(g);if(d.length!==m.length)return!1;var b=e,j=t,E=function(O){return r(b[O],j[O])};return d.every(E)},pe=function(e,t,n){return R(e)?Object.keys(e).reduce(function(o,a){var c=!R(t)||!Me(e[a],t[a]);return n.includes(a)?(c&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),o):c?te(te({},o||{}),{},ce({},a,e[a])):o},null):null},fe="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",oe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fe;if(e===null||$e(e))return e;throw new Error(t)},qe=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fe;if(Be(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(o){return oe(o,t)})};var n=oe(e,t);return n===null?{tag:"empty"}:{tag:"sync",stripe:n}},Je=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.7.0"}),e.registerAppInfo({name:"react-stripe-js",version:"2.7.0",url:"https://stripe.com/docs/stripe-js/react"}))},F=u.createContext(null);F.displayName="ElementsContext";var de=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},me=function(e){var t=e.stripe,n=e.options,o=e.children,a=u.useMemo(function(){return qe(t)},[t]),c=u.useState(function(){return{stripe:a.tag==="sync"?a.stripe:null,elements:a.tag==="sync"?a.stripe.elements(n):null}}),m=le(c,2),s=m[0],g=m[1];u.useEffect(function(){var d=!0,b=function(E){g(function(w){return w.stripe?w:{stripe:E,elements:E.elements(n)}})};return a.tag==="async"&&!s.stripe?a.stripePromise.then(function(j){j&&d&&b(j)}):a.tag==="sync"&&!s.stripe&&b(a.stripe),function(){d=!1}},[a,s,n]);var y=G(t);u.useEffect(function(){y!==null&&y!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[y,t]);var S=G(n);return u.useEffect(function(){if(s.elements){var d=pe(n,S,["clientSecret","fonts"]);d&&s.elements.update(d)}},[n,S,s.elements]),u.useEffect(function(){Je(s.stripe)},[s.stripe]),u.createElement(F.Provider,{value:s},o)};me.propTypes={stripe:l.any,options:l.object};var Ye=function(e){var t=u.useContext(F);return de(t,e)},ze=function(){var e=Ye("calls useElements()"),t=e.elements;return t};l.func.isRequired;var ve=u.createContext(null);ve.displayName="CustomCheckoutSdkContext";var Ke=function(e,t){if(!e)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(t," in an <CustomCheckoutProvider> provider."));return e},Ge=u.createContext(null);Ge.displayName="CustomCheckoutContext";l.any,l.shape({clientSecret:l.string.isRequired,elementsOptions:l.object}).isRequired;var V=function(e){var t=u.useContext(ve),n=u.useContext(F);if(t&&n)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CustomCheckoutProvider> and <Elements> providers."));return t?Ke(t,e):de(n,e)},Ve=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},p=function(e,t){var n="".concat(Ve(e),"Element"),o=function(s){var g=s.id,y=s.className,S=s.options,d=S===void 0?{}:S,b=s.onBlur,j=s.onFocus,E=s.onReady,w=s.onChange,O=s.onEscape,B=s.onClick,$=s.onLoadError,M=s.onLoaderStart,q=s.onNetworksChange,J=s.onConfirm,Y=s.onCancel,v=s.onShippingAddressChange,A=s.onShippingRateChange,N=V("mounts <".concat(n,">")),D="elements"in N?N.elements:null,I="customCheckoutSdk"in N?N.customCheckoutSdk:null,he=u.useState(null),X=le(he,2),h=X[0],ye=X[1],k=u.useRef(null),z=u.useRef(null);C(h,"blur",b),C(h,"focus",j),C(h,"escape",O),C(h,"click",B),C(h,"loaderror",$),C(h,"loaderstart",M),C(h,"networkschange",q),C(h,"confirm",J),C(h,"cancel",Y),C(h,"shippingaddresschange",v),C(h,"shippingratechange",A),C(h,"change",w);var K;E&&(e==="expressCheckout"?K=E:K=function(){E(h)}),C(h,"ready",K),u.useLayoutEffect(function(){if(k.current===null&&z.current!==null&&(D||I)){var x=null;I?x=I.createElement(e,d):D&&(x=D.create(e,d)),k.current=x,ye(x),x&&x.mount(z.current)}},[D,I,d]);var H=G(d);return u.useEffect(function(){if(k.current){var x=pe(d,H,["paymentRequest"]);x&&k.current.update(x)}},[d,H]),u.useLayoutEffect(function(){return function(){if(k.current&&typeof k.current.destroy=="function")try{k.current.destroy(),k.current=null}catch{}}},[]),u.createElement("div",{id:g,className:y,ref:z})},a=function(s){V("mounts <".concat(n,">"));var g=s.id,y=s.className;return u.createElement("div",{id:g,className:y})},c=t?a:o;return c.propTypes={id:l.string,className:l.string,onChange:l.func,onBlur:l.func,onFocus:l.func,onReady:l.func,onEscape:l.func,onClick:l.func,onLoadError:l.func,onLoaderStart:l.func,onNetworksChange:l.func,onConfirm:l.func,onCancel:l.func,onShippingAddressChange:l.func,onShippingRateChange:l.func,options:l.object},c.displayName=n,c.__elementType=e,c},f=typeof window>"u",Xe=u.createContext(null);Xe.displayName="EmbeddedCheckoutProviderContext";var He=function(){var e=V("calls useStripe()"),t=e.stripe;return t};p("auBankAccount",f);var ae=p("card",f);p("cardNumber",f);p("cardExpiry",f);p("cardCvc",f);p("fpxBank",f);p("iban",f);p("idealBank",f);p("p24Bank",f);p("epsBank",f);p("payment",f);p("expressCheckout",f);p("paymentRequestButton",f);p("linkAuthentication",f);p("address",f);p("shippingAddress",f);p("paymentMethodMessaging",f);p("affirmMessage",f);p("afterpayClearpayMessage",f);const Ze=async(r,e)=>{try{return(await Ce.post("http://localhost:8000/api/create-payment-intent",{couponApplied:e},{headers:{authtoken:r}})).data}catch(t){console.log(t)}},Qe=()=>{const r=ge(),{user:e,coupon:t}=Se(v=>({...v})),[n,o]=P.useState(!1),[a,c]=P.useState(null),[m,s]=P.useState(""),[g,y]=P.useState(!0),[S,d]=P.useState(0),[b,j]=P.useState(0),[E,w]=P.useState(0),[O,B]=P.useState(""),$=He(),M=ze(),q={style:{base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#32325d"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}};P.useEffect(()=>{Ze(e.token,t).then(v=>{console.log("create payment intent",v),B(v.clientSecret),d(v.cartTotal),j(v.totalAfterDiscount),w(v.payable)})},[]);const J=async v=>{v.preventDefault(),s(!0);const A=await $.confirmCardPayment(O,{payment_method:{card:M.getElement(ae),billing_details:{name:v.target.name.value}}});A.error?(c(`Payment failed ${A.error.message}`),s(!1)):(be(A,e.token).then(N=>{N.ok&&(typeof window<"u"&&localStorage.removeItem("cart"),r({type:"ADD_TO_CART",payload:[]}),r({type:"COUPON_APPLIED",payload:!1}),je(e.token))}),console.log(JSON.stringify(A,null,4)),c(null),s(!1),o(!0))},Y=async v=>{y(v.empty),c(v.error?v.error.message:"")};return i.jsxs("div",{children:[!n&&i.jsx("div",{children:t&&b!==void 0?i.jsx("p",{className:"alert alert-success",children:`Total after discount: $${b}`}):i.jsx("p",{className:"alert alert-danger",children:"No coupon applied"})}),i.jsx("div",{className:"text-center pb-5",children:i.jsx(Pe,{cover:i.jsx("img",{src:xe,style:{height:"200px",objectFit:"cover",marginBottom:"-50px"}}),actions:[i.jsxs(i.Fragment,{children:[i.jsx(we,{className:"text-info"})," ",i.jsx("br",{})," Total $",S]}),i.jsxs(i.Fragment,{children:[i.jsx(ke,{className:"text-info"})," ",i.jsx("br",{})," Total payable: $",(E/100).toFixed(2)]})]})}),i.jsxs("form",{id:"payment-form",className:"stripe-form",onSubmit:J,children:[i.jsx(ae,{id:"card-element",options:q,onChange:Y}),i.jsx("button",{className:"stripe-button",disabled:m||g||n,children:i.jsx("span",{id:"button-text",children:m?i.jsx("div",{className:"spinner",id:"spinner"}):"Pay"})}),i.jsx("br",{}),a&&i.jsx("div",{className:"card-error text-bg-danger",role:"alert",children:a}),i.jsxs("p",{className:n?"result-message":"result-message hidden",children:["Payment Successful.",i.jsx(Ee,{to:"/user/history",children:"See it in your purchase history"})]})]})]})},et=Ie("pk_test_51OFEz0FWTRAExXIa1iPa1yBdYA2ufoOECKidJ5a9DFS7DfuGITeFZzoHhgx0Bg4g6tJJ1NjLT2NDanecxMeoffY7003uOhWxVf"),lt=()=>i.jsxs("div",{className:"container p-5 text-center",children:[i.jsx("h4",{children:"Complete your purchase"}),i.jsx(me,{stripe:et,children:i.jsx("div",{className:"col-md-8 offset-md-2",children:i.jsx(Qe,{})})})]});export{lt as default};
